schema_version: 2

# Metadata
id: "dev8h6"
source_events:
  - "m3n4o5"
  - "x9y8z7"
  - "p1q2r3"
title: "DevOps and Security Hardening"
label: "refacts"
priority: "medium"
summary: "CI/CD pipeline has unpinned dependencies, duplicated logic, and no release workflow."

# Content
problem: |
  The DevOps infrastructure has several weaknesses:
  1. **Supply Chain Risk:** GitHub Actions are pinned to mutable tags (e.g., `@v5`) instead of immutable SHAs. Homebrew installs (`shellcheck`, `shfmt`) use implicit 'latest'.
  2. **Duplication:** Setup logic for `mlx-lm` venv is duplicated across `lint-and-test.yml` and `setup-python.yml`.
  3. **Missing Artifacts:** There is no automated workflow to build, sign, and publish release artifacts (wheels/sdists). Installation relies on git source.

impact: |
  - **Security:** Vulnerability to supply chain attacks via tag hijacking.
  - **Reproducibility:** Builds might break if external tools update.
  - **Maintenance:** Duplicated logic increases the risk of drift.
  - **Delivery:** Manual installation from git is less user-friendly and harder to version control properly.

desired_outcome: |
  - Pin all GitHub Actions to commit SHAs.
  - Pin Homebrew installs or use a pinned Action for tools.
  - Deduplicate setup logic into a composite action or script.
  - Create a release workflow that builds and publishes artifacts on tag push.

constraints: []
risks: []

# Specifics
affected_areas:
  - ".github/workflows/lint-and-test.yml"
  - ".github/workflows/setup-python.yml"
  - ".github/actions/setup-base/action.yml"

acceptance_criteria:
  - "All 'uses' directives in workflows use SHAs."
  - "Linting tools are installed with specific versions."
  - "MLX setup logic is centralized."
  - "A release workflow exists."

verification_commands:
  - "grep '@v[0-9]' .github/workflows/*.yml" # Should be empty/minimal

# Analysis Flags
requires_deep_analysis: false
deep_analysis_reason: ""
