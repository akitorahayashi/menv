schema_version: 1

# Metadata
id: "qa0001"
issue_id: "tst2j9"
created_at: "2024-05-22"
author_role: "qa"
confidence: "high"

# Content
title: "High-Risk Mirror Logic in Role Integrity Tests"
statement: |
  `tests/intg/test_role_integrity.py` re-implements Ansible's variable resolution and path finding logic in Python (using regex and manual string manipulation) to validate static files. This "Mirror Logic" creates a false sense of security: if the manual resolution differs from actual Ansible behavior (which is complex and version-dependent), the test passes but the playbook fails at runtime. It validates the author's *expectation* of how Ansible works, not how it *actually* works.

# Evidence supporting the observation
evidence:
  - path: "tests/intg/test_role_integrity.py"
    loc:
      - "_resolve_template_literal"
      - "_resolve_lookup_expression"
      - "LocalConfigRoot"
    note: "Manual re-implementation of Jinja2/Ansible variable and path resolution logic."

tags:
  - "anti-pattern"
  - "risk"
  - "maintenance-burden"
