schema_version: 1

# Metadata
id: "tstvio"
issue_id: "t3st15"
created_at: "2026-02-01"
author_role: "consistency"
confidence: "high"

# Content
title: "Unit Tests Violate Isolation Rules"
statement: |
  `AGENTS.md` requires unit tests to be fast, mock-based, and free of external processes. Tests in `tests/unit/commands/` (e.g., `test_config.py`) import `menv.main.app`, which initializes the full dependency graph including `ConfigStorage`, causing side effects on the live filesystem (`~/.config/menv`) during unit test execution.

# Evidence supporting the observation
evidence:
  - path: "AGENTS.md"
    loc:
      - "Testing"
    note: "Rule: 'Unit tests only (fast, mocks, no external processes)'"
  - path: "tests/unit/commands/test_config.py"
    loc:
      - "from menv.main import app"
    note: "Imports real app with real dependencies."
  - path: "src/menv/main.py"
    loc:
      - "ctx.obj = AppContext("
    note: "Initializes real ConfigStorage and AnsibleRunner."

tags:
  - "architecture"
  - "testing"
  - "violation"
  - "risk"
