schema_version: 1

# Metadata
id: "mx4i0r"
issue_id: ""
created_at: "2026-01-31"
author_role: "pythonista"
confidence: "medium"

# Content
title: "Mixed I/O and Logic in AnsibleRunner"
statement: |
  `AnsibleRunner.run_playbook` mixes command construction logic with direct I/O operations (subprocess execution, `sys.stdout` writes), making the core logic difficult to test and mock.

evidence:
  - path: "src/menv/services/ansible_runner.py"
    loc:
      - "69"
    note: "Direct use of `subprocess.Popen` inside the runner logic."
  - path: "src/menv/services/ansible_runner.py"
    loc:
      - "80"
    note: "Direct writes to `sys.stdout` instead of using a passed-in stream or logger."
  - path: "src/menv/services/ansible_runner.py"
    loc:
      - "59"
    note: "Environment mutation `env['ANSIBLE_CONFIG'] = str(config_path)` inside the execution method."

tags:
  - "anti-pattern"
  - "testability"
  - "io-separation"
